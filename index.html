<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ„ Mariah Carey è–èª•å€’æ•¸ x ä¸‹ç­è¨ˆç®—æ©Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      margin: 0; padding: 20px; min-height: 100vh;
      color: #fff; overflow-x: hidden;
      transition: background 1s ease;
    }
    .main-wrapper { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; position: relative; z-index: 5; }
    .panel {
      background: rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;
      max-width: 360px; border: 2px solid #f8c25c; box-shadow: 0 8px 24px rgba(255,255,255,0.2);
      backdrop-filter: blur(6px);
    }
    h1, h2 { text-align: center; color: #f8c25c; }
    .mariah-title { font-weight: bold; font-size: 20px; color: #f8c25c; margin-bottom: 12px; text-align: center; }
    #mariahVideo { width: 100%; border-radius: 12px; }

    /* é›ªèŠ±æ•ˆæœ */
    .snowflake { position: fixed; color: white; pointer-events: none; z-index: 0; opacity: 0.9; text-shadow: 0 0 8px rgba(255,255,255,0.6); }

    /* ğŸ¬ å…¨è¢å¹• Overlay */
    #xmasOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: black; z-index: 9999; display: none; justify-content: center; align-items: center;
      animation: fadeIn 1s ease;
      flex-direction: column;
    }
    #xmasOverlay iframe {
      width: 100%; height: 100%; border: none;
    }
    #xmasText {
      position: absolute; bottom: 10%; text-align: center; font-size: 36px;
      color: #fff; text-shadow: 0 0 10px #f8c25c;
      opacity: 0; transition: opacity 2s ease;
    }
    #xmasText.show { opacity: 1; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>

<body>
  <!-- ğŸ¬ è–èª•ç¯€ / å¹³å®‰å¤œ Overlay -->
  <div id="xmasOverlay">
    <div id="xmasText"></div>
  </div>

  <div class="main-wrapper">
    <div class="panel" id="holiday-box"></div>

    <div class="panel">
      <h1>ğŸ„ ä»€éº¼æ™‚å€™å¯ä»¥å›å®¶ ğŸ…</h1>
      <h2>ä¸‹ç­æ™‚é–“è¨ˆç®—æ©Ÿ</h2>
      <label for="start">ä¸Šç­æ™‚é–“ (hhmm):</label>
      <input type="text" id="start" placeholder="HHMM" inputmode="numeric" />
      <button onclick="calc()">è¨ˆç®—ä½ çš„ä¸‹ç­æ™‚é–“</button>
      <div id="result"></div>
      <div id="countdown" style="display:none;">
        <div>è·é›¢ä¸‹ç­é‚„æœ‰ï¼š</div>
        <div><span id="h">00</span> å°æ™‚ <span id="m">00</span> åˆ†é˜ <span id="s">00</span> ç§’</div>
      </div>
    </div>

    <div class="panel" id="mariah-panel">
      <div class="mariah-title">â„ï¸ æ­£åœ¨è§£å‡ Mariah Carey... ğŸ¶</div>
      <video id="mariahVideo" src="./mariah-defrosting-slow.mp4" muted playsinline preload="auto"></video>
    </div>
  </div>

  <script>
    /* === ä¸‹ç­å€’æ•¸ === */
    let timer, offTime;
    function update() {
      if (!offTime) return;
      const now = new Date(), diff = offTime - now;
      if (diff <= 0) { clearInterval(timer); document.getElementById('countdown').style.display='none'; document.getElementById('result').innerHTML += '<br>ğŸ‰ ä¸‹ç­å•¦ï¼'; return; }
      document.getElementById('h').textContent = String(Math.floor(diff/3600000)).padStart(2,'0');
      document.getElementById('m').textContent = String(Math.floor(diff%3600000/60000)).padStart(2,'0');
      document.getElementById('s').textContent = String(Math.floor(diff%60000/1000)).padStart(2,'0');
    }
    function calc(){
      const input=document.getElementById("start").value;const result=document.getElementById("result");
      if(!input||input.length!==4||isNaN(input)){result.innerText="è«‹è¼¸å…¥HHMM";return;}
      const h=parseInt(input.slice(0,2)),m=parseInt(input.slice(2));
      const now=new Date(),start=new Date(now.getFullYear(),now.getMonth(),now.getDate(),h,m);
      offTime=new Date(start.getTime()+9.5*3600000);
      result.innerHTML=`ğŸ•” ä¸‹ç­æ™‚é–“ï¼š${offTime.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;
      document.getElementById('countdown').style.display='block';
      if(timer)clearInterval(timer);update();timer=setInterval(update,1000);
    }

    /* === è–èª•ç¯€å€’æ•¸ === */
    const today = new Date();
    const christmas = new Date(today.getFullYear(), 11, 25);
    if (today > christmas) christmas.setFullYear(today.getFullYear() + 1);
    const daysLeft = Math.ceil((christmas - today) / 86400000);
    document.getElementById("holiday-box").innerHTML = `<h2>ğŸ è–èª•ç¯€å€’æ•¸</h2><p>è·é›¢è–èª•ç¯€é‚„æœ‰ <strong>${daysLeft}</strong> å¤©</p>`;

    /* === è§£å‡å½±ç‰‡ === */
    const mariahVideo = document.getElementById("mariahVideo");
    mariahVideo.addEventListener("loadedmetadata", () => {
      // è§£å‡é€²åº¦ï¼šåªåˆ° 12/23 ç‚ºæ­¢
      const yearStart = new Date(today.getFullYear(), 0, 0);
      const dayOfYear = Math.floor((today - yearStart) / 86400000);
      const christmasEveDay = Math.floor((new Date(today.getFullYear(), 11, 24) - yearStart) / 86400000);
      const progress = Math.min(dayOfYear / christmasEveDay, 1);
      mariahVideo.currentTime = mariahVideo.duration * progress;
    });

    /* === 12/24 & 12/25: å…¨è¢å¹•æ’­æ”¾æ­Œæ›² === */
    const overlay = document.getElementById("xmasOverlay");
    const text = document.getElementById("xmasText");
    const month = today.getMonth(), date = today.getDate();

    if (month === 11 && (date === 24 || date === 25)) {
      overlay.style.display = "flex";
      overlay.innerHTML = `
        <iframe src="https://www.youtube.com/embed/aAkMkVFwAoo?autoplay=1&controls=1&fs=1&rel=0"
                allow="autoplay; fullscreen" allowfullscreen></iframe>
        <div id="xmasText">${date === 24 ? "ğŸ… Mariah Carey è§£å‡å®Œæˆï¼" : "ğŸ‰ Merry Christmas Everyone! ğŸ’–"}</div>`;
      setTimeout(() => {
        document.getElementById("xmasText").classList.add("show");
      }, 10000);
    }

    /* === é›ªèŠ± === */
    const snowflakes=[];const maxSnowflakes=(date===24||date===25)?150:80;
    class Snowflake{constructor(){this.size=Math.random()*10+6;this.x=Math.random()*window.innerWidth;this.y=-this.size;this.vx=(Math.random()-0.5)*0.3;this.vy=Math.random()*0.5+0.2;this.el=document.createElement("div");this.el.className="snowflake";this.el.textContent="â„ï¸";this.el.style.fontSize=this.size+"px";document.body.appendChild(this.el);}
      update(){this.x+=this.vx;this.y+=this.vy;if(this.y>=window.innerHeight-this.size){this.y=window.innerHeight-this.size;this.vy=0;this.vx=0;}
      this.el.style.left=`${this.x}px`;this.el.style.top=`${this.y}px`;}}
    function createSnowflake(){if(snowflakes.length<maxSnowflakes)snowflakes.push(new Snowflake());}
    function animateSnow(){createSnowflake();for(const f of snowflakes)f.update();requestAnimationFrame(animateSnow);}
    animateSnow();
  </script>
</body>
</html>
