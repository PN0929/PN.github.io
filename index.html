<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ä»€éº¼æ™‚å€™å¯ä»¥å›å®¶ ä¸‹ç­æ™‚é–“è¨ˆç®—æ©Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #737F4E 0%, #5a6640 100%);
      margin: 0; padding: 20px; min-height: 100vh;
    }
    .main-wrapper {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 20px; position: relative; z-index: 10; align-items: stretch;
    }
    .panel-tall { display: flex; flex-direction: column; }
    #holiday-box { justify-content: center; }
    .panel {
      background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(204, 160, 50, 0.4), 0 0 20px rgba(188, 92, 55, 0.2);
      padding: 20px; width: 100%; max-width: 360px;
      border: 3px solid #CCA032; position: relative;
      transition: all 0.3s;
    }
    .panel:hover {
      box-shadow: 0 8px 40px rgba(204, 160, 50, 0.6), 0 0 30px rgba(188, 92, 55, 0.4);
      transform: translateY(-2px);
    }
    .holiday-title {
      font-size: 22px; font-weight: bold; text-align: center;
      color: #BC5C37; margin-bottom: 10px; margin-top: 0;
      text-shadow: 0 0 10px rgba(188, 92, 55, 0.3);
    }
    .holiday-date { font-size: 16px; text-align: center; margin-bottom: 12px; color: #5a6640; }
    .holiday-countdown { text-align: center; font-size: 16px; color: #555; }
    .horoscope {
      margin-top: 15px; padding: 12px;
      background: linear-gradient(135deg, #737F4E 0%, #5a6640 100%);
      border-radius: 8px; color: #fef08a; font-size: 14px; line-height: 1.6;
      box-shadow: 0 2px 8px rgba(115, 127, 78, 0.3); border: 2px solid #CCA032;
    }
    .flip-number {
      display: inline-block; font-family: 'Courier New', monospace;
      background: linear-gradient(135deg, #BC5C37 0%, #a54d2f 100%);
      color: #fff; padding: 10px 14px; border-radius: 6px;
      font-size: 26px; margin: 0 6px;
      box-shadow: 0 4px 12px rgba(188, 92, 55, 0.5), 0 0 15px rgba(204, 160, 50, 0.3);
      border: 2px solid #CCA032; letter-spacing: 1px;
    }
    h1, h2 { text-align: center; color: #BC5C37; text-shadow: 0 0 10px rgba(188, 92, 55, 0.2); }
    label { font-size: 16px; display: block; margin-top: 10px; color: #737F4E; font-weight: 600; }
    input[type="text"] {
      width: 100%; padding: 10px; margin: 5px 0 15px;
      border: 2px solid #CCA032; border-radius: 4px; font-size: 16px; transition: border 0.3s;
      background: #faf9f0;
    }
    input[type="text"]:focus { outline: none; border-color: #BC5C37; background: #fff; }
    button {
      background: linear-gradient(135deg, #BC5C37 0%, #a54d2f 100%);
      color: white; padding: 14px; font-size: 18px; border: none; border-radius: 4px;
      cursor: pointer; width: 100%; position: relative; overflow: hidden;
      box-shadow: 0 4px 12px rgba(188, 92, 55, 0.4);
      font-weight: 600;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(188, 92, 55, 0.6), 0 0 20px rgba(204, 160, 50, 0.4);
      transition: all 0.3s;
    }
    button:hover::after {
      content: 'ğŸ„';
      position: absolute; right: 15px; top: 50%;
      transform: translateY(-50%); animation: ghostFloat 2s infinite;
    }
    @keyframes ghostFloat { 0%, 100% { transform: translateY(-50%); } 50% { transform: translateY(-70%); } }
    #result { text-align: center; margin-top: 20px; font-size: 18px; color: #737F4E; }
    #countdown {
      margin-top: 25px; padding: 20px;
      background: linear-gradient(135deg, #BC5C37 0%, #a54d2f 100%);
      border-radius: 10px; text-align: center; display: none;
      color: white; box-shadow: 0 4px 12px rgba(188, 92, 55, 0.5), 0 0 20px rgba(204, 160, 50, 0.3);
      border: 3px solid #CCA032;
    }
    #countdown-display { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
    .countdown-unit { 
      background: rgba(255,255,255,0.25); 
      border-radius: 8px; padding: 15px 20px; min-width: 80px;
      border: 2px solid rgba(204, 160, 50, 0.5);
    }
    .countdown-number { font-size: 32px; font-weight: bold; display: block; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    .countdown-label { font-size: 14px; margin-top: 5px; opacity: 0.95; }
    .countdown-reminder { margin-top: 10px; font-size: 13px; opacity: 0.95; }
    #loading { display: none; text-align: center; margin: 20px 0; }
    .ghost-loader { display: inline-block; font-size: 50px; animation: ghostSpin 1.5s linear infinite; }
    @keyframes ghostSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    #xmasOverlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.9);
      display: none; justify-content: center; align-items: center; flex-direction: column;
      z-index: 9999; padding: 20px;
    }
    #xmasOverlay button {
      background: linear-gradient(135deg, #BC5C37 0%, #a54d2f 100%);
      border: 2px solid #CCA032; color: #fff; padding: 10px 16px; border-radius: 6px;
      margin: 6px; cursor: pointer; font-weight: 600;
    }

    .snowflake {
      position: fixed; color: white; pointer-events: none; z-index: 0;
      text-shadow: 0 0 8px rgba(255,255,255,0.6);
    }

    .mariah-wrap {
      position: relative; border-radius: 8px; overflow: hidden;
      background: radial-gradient(closest-side, rgba(188, 92, 55, 0.15), transparent);
      border: 2px solid rgba(204, 160, 50, 0.5);
    }
    .mariah-video, .mariah-fallback {
      width: 100%; display: block; border-radius: 8px;
      aspect-ratio: 16 / 9; object-fit: cover; height: auto;
      background: #000;
    }
    @supports not (aspect-ratio: 1 / 1) {
      .mariah-video, .mariah-fallback { height: 202px; }
    }

    @media (max-width: 1024px) {
      .main-wrapper { flex-direction: column; align-items: center; }
    }
  </style>
</head>
<body>
  <div id="xmasOverlay"></div>

  <div class="main-wrapper">
    <div class="panel panel-tall" id="holiday-box"></div>

    <div class="panel panel-tall">
      <h1>ğŸ„ ä»€éº¼æ™‚å€™å¯ä»¥å›å®¶ ğŸ…</h1>
      <h2>HURCä¸‹ç­æ™‚é–“è¨ˆç®—æ©Ÿ</h2>
      <label for="start">ä¸Šç­æ™‚é–“ (hhmm):</label>
      <input type="text" id="start" placeholder="HHMM" inputmode="numeric" pattern="[0-9]*" />
      <button onclick="calc()">è¨ˆç®—ä½ çš„ä¸‹ç­æ™‚é–“</button>
      <div id="loading">
        <div class="ghost-loader">ğŸ…</div>
        <div style="margin-top:10px;color:#737F4E;">è¨ˆç®—ä¸­...</div>
      </div>
      <h3 id="result"></h3>
      <div id="countdown">
        <div style="font-size:18px;font-weight:bold;margin-bottom:15px">è·é›¢å¯ä»¥é›¢é–‹è¾¦å…¬å®¤é‚„æœ‰</div>
        <div id="countdown-display">
          <div class="countdown-unit">
            <span class="countdown-number" id="h">00</span>
            <div class="countdown-label">å°æ™‚</div>
          </div>
          <div class="countdown-unit">
            <span class="countdown-number" id="m">00</span>
            <div class="countdown-label">åˆ†é˜</div>
          </div>
          <div class="countdown-unit">
            <span class="countdown-number" id="s">00</span>
            <div class="countdown-label">ç§’</div>
          </div>
        </div>
        <div class="countdown-reminder">ğŸ ä¸è¦åŠ ç­å¤ªä¹…å–”ï¼</div>
      </div>
    </div>

    <div class="panel panel-tall">
      <div class="holiday-title" style="margin-bottom:12px;">â„ï¸ æ­£åœ¨è§£å‡ Mariah Carey...</div>

      <img
        id="mariahFallback"
        class="mariah-fallback"
        src="./mariah-poster.jpg"
        alt="Mariah Carey"
        loading="eager"
      />

      <div class="mariah-wrap" id="mariahWrap">
        <video
          id="mariahVideo"
          class="mariah-video"
          poster="./mariah-poster.jpg"
          preload="metadata"
          muted
          playsinline
          webkit-playsinline
          disablepictureinpicture
        >
          <source src="./mariah-defrosting-slow.mp4" type="video/mp4" />
        </video>
      </div>
    </div>
  </div>

  <div style="text-align: center; margin-top: 20px; padding: 15px;">
    <div style="font-size: 14px; color: #fef08a;">ğŸ‘©â€ğŸ’» æ²›æ© æ›´æ–°æ–¼ 2025 å¹´ 11 æœˆ 2 æ—¥</div>
    <div style="font-size: 13px; color: #fef08a; margin-top: 5px;">ğŸ“ å›ä¾†ä¸Šç­äº†ï¼±ï¼±</div>
  </div>

  <script>
    let timer, offTime;

    function update() {
      if (!offTime) return;
      const now = new Date();
      const diff = offTime - now;
      if (diff <= 0) {
        clearInterval(timer);
        document.getElementById('countdown').style.display = 'none';
        const result = document.getElementById('result');
        if (!result.innerHTML.includes('ä¸‹ç­æ™‚é–“åˆ°äº†')) {
          result.innerHTML += '<br><br>ğŸ‰ <strong>ä¸‹ç­æ™‚é–“åˆ°äº†ï¼å¿«å›å®¶å§ï¼</strong>';
        }
        return;
      }
      document.getElementById('h').textContent = String(Math.floor(diff / 3600000)).padStart(2, '0');
      document.getElementById('m').textContent = String(Math.floor(diff % 3600000 / 60000)).padStart(2, '0');
      document.getElementById('s').textContent = String(Math.floor(diff % 60000 / 1000)).padStart(2, '0');
    }

    function calc() {
      const input = document.getElementById("start").value;
      const result = document.getElementById("result");
      const loading = document.getElementById("loading");
      loading.style.display = 'block';
      result.innerHTML = '';
      document.getElementById('countdown').style.display = 'none';

      setTimeout(() => {
        loading.style.display = 'none';

        if (!input || input.length !== 4 || isNaN(input)) { result.innerText = "è«‹æ‚¨å†ä»”ç´°ç¢ºèªä¸Šç­æ™‚é–“ï¼Œä¸è¦ç©ç³»çµ± ^^"; return; }
        const h = parseInt(input.substring(0, 2)), min = parseInt(input.substring(2, 4));
        if (h < 0 || h > 23 || min < 0 || min > 59) { result.innerText = "è«‹æ‚¨å†ä»”ç´°ç¢ºèªä¸Šç­æ™‚é–“ï¼Œä¸è¦ç©ç³»çµ± ^^"; return; }
        if (input >= "0000" && input < "0730") { result.innerText = "ä¸Šç­æ™‚é–“æœ€æ—©å¾ 07:30 æ‰“å¡å”·ï¼"; return; }
        if (input >= "1200" && input <= "2359") { result.innerText = "å»ºè­°æ‚¨ç›´æ¥è«‹å‡ ^^"; return; }
        const now = new Date();
        const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, min, 0);
        const work = 9.5 * 3600000;
        const late = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 9, 0, 0);

        if (start > late) {
          const leaveMins = Math.ceil((start - late) / 60000 / 30) * 30;
          const leaveStart = new Date(start.getTime() - leaveMins * 60000);
          const properOffTime = new Date(leaveStart.getTime() + work);
          result.innerHTML =
            (h >= 11 ? "âš ï¸ å¤ªæ™šäº†å§ï¼è¦ä¸è¦ç›´æ¥å›å®¶<br>" : "âš ï¸ æ³¨æ„ï¼æ‚¨å·²ç¶“é²åˆ°äº†ï¼<br>") +
            `å»ºè­°æ‚¨é€™æ¨£è«‹å‡ï¼š${leaveStart.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} - ${start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}ã€‚<br>` +
            `â° å»ºè­°è«‹å‡æ™‚é•·ç‚ºï¼š${Math.floor(leaveMins/60)}å°æ™‚${leaveMins%60}åˆ†é˜ã€‚<br>`;
          result.innerHTML += `ğŸ•” è«‹å®Œå‡å¾Œå»ºè­°åœ¨ ${properOffTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} ä¸‹ç­`;
          offTime = new Date(start.getTime() + work);
        } else {
          result.innerHTML = "ğŸ‰ ä»Šå¤©åŠªåŠ›èµ·åºŠä¸Šç­äº†ï¼ç¹¼çºŒä¿æŒï¼<br>";
          offTime = new Date(start.getTime() + work);
          result.innerHTML += `ğŸ•” æ‚¨çš„ä¸‹ç­æ™‚é–“æ˜¯ï¼š${offTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
        }

        document.getElementById('countdown').style.display = 'block';
        if (timer) clearInterval(timer);
        update();
        timer = setInterval(update, 1000);
      }, 800);
    }

    // è–èª•å€’æ•¸ + æ˜Ÿåº§å»ºè­°
    (function(){
      const today = new Date();
      const christmas = new Date(today.getFullYear(), 11, 25);
      if (christmas < today) christmas.setFullYear(today.getFullYear() + 1);
      const daysLeft = Math.ceil((christmas - today) / 86400000);
      const giftHoroscopes = [
        { sign: "â™ˆ ç‰¡ç¾Šåº§", msg: "é€ä½ ä¸€é»ç†±å¯å¯ï¼Œè·Ÿä½ ä¸€æ¨£ç«ç†±ğŸ”¥" },
        { sign: "â™‰ é‡‘ç‰›åº§", msg: "ç”œç”œçš„è‚‰æ¡‚æ²ï¼‹ä¸€æ•´å¤©ç¡è¦ºæœ€é©åˆä½  ğŸ˜´" },
        { sign: "â™Š é›™å­åº§", msg: "é›™ä»½ç¦®ç‰©æ¯”è¼ƒå…¬å¹³ï¼Œä½ éƒ½æƒ³è¦ ğŸ˜" },
        { sign: "â™‹ å·¨èŸ¹åº§", msg: "ä¸€æ¢æ¯›æ¯¯å°±èƒ½æŠŠä½ ç•™åœ¨å®¶è£¡ â¤ï¸" },
        { sign: "â™Œ ç…å­åº§", msg: "é‡‘è‰²åœå·¾è®“ä½ ç¹¼çºŒç•¶å…¨è¾¦å…¬å®¤æœ€äº®çš„ â˜€ï¸" },
        { sign: "â™ è™•å¥³åº§", msg: "æ‰‹å¸³ï¼‹è²¼ç´™ï¼Œè–èª•ä¹Ÿè¦æœ‰ç§©åº ğŸ“˜" },
        { sign: "â™ å¤©ç§¤åº§", msg: "é¦™æ°›è Ÿç‡­ï¼‹è–èª•æ­Œï¼Œå…¨éƒ¨éƒ½è¦å¾ˆç¾ âœ¨" },
        { sign: "â™ å¤©è åº§", msg: "ç¥ç§˜é»‘å·§å…‹åŠ›è·Ÿä½ ä¸€æ¨£é«˜ç´š ğŸ«" },
        { sign: "â™ å°„æ‰‹åº§", msg: "æ—…è¡ŒåŸºé‡‘æˆ–æ˜¯ç›´æ¥æ”¾ä½ ä¸‹ç­ âœˆï¸" },
        { sign: "â™‘ æ‘©ç¾¯åº§", msg: "å¯¦ç”¨çš„ä¿æº«ç“¶ï¼Œé‚ŠåŠ ç­é‚Šå– ğŸ¥¤" },
        { sign: "â™’ æ°´ç“¶åº§", msg: "å¥‡æ€ªçš„è–èª•é›»å­å°ç‰©ä½ æœƒæœ€æ„› âš¡" },
        { sign: "â™“ é›™é­šåº§", msg: "é›ªæ™¯éŸ³æ¨‚ç›’ï¼Œè®“ä½ é‚Šè½é‚Šåšå¤¢ ğŸŒ¨ï¸" }
      ];
      const randomGift = giftHoroscopes[Math.floor(Math.random() * giftHoroscopes.length)];
      document.getElementById("holiday-box").innerHTML =
        `<div class="holiday-title">ğŸ„ è–èª•ç¯€å€’æ•¸</div>
         <div class="holiday-date">è·é›¢è–èª•ç¯€é‚„æœ‰ <span class="flip-number">${daysLeft}</span> å¤©</div>
         <div class="horoscope"><strong>${randomGift.sign}</strong><br>${randomGift.msg}</div>`;
    })();

    // å½±ç‰‡å¯ç”¨å‰‡é¡¯ç¤ºå½±ç‰‡ã€å¦å‰‡ä¿æŒåœ–ç‰‡
    const mariahVideo = document.getElementById("mariahVideo");
    const mariahFallback = document.getElementById("mariahFallback");
    let metaLoaded = false;

    function switchToVideoIfReady() {
      if (isFinite(mariahVideo.duration) && mariahVideo.duration > 0) {
        const today = new Date();
        const yearStart = new Date(today.getFullYear(), 0, 1);
        const dayOfYear = Math.floor((today - yearStart) / 86400000);
        const christmasEveDay = Math.floor((new Date(today.getFullYear(), 11, 24) - yearStart) / 86400000);
        const progress = Math.min(dayOfYear / christmasEveDay, 1);
        mariahVideo.currentTime = mariahVideo.duration * progress;
        mariahFallback.style.display = "none";
        mariahVideo.style.visibility = "visible";
      }
    }

    mariahVideo.style.visibility = "hidden";
    mariahVideo.addEventListener("loadedmetadata", () => {
      metaLoaded = true;
      switchToVideoIfReady();
    }, { once: true });

    mariahVideo.addEventListener("loadeddata", () => {
      if (!metaLoaded) metaLoaded = true;
      switchToVideoIfReady();
    }, { once: true });

    mariahVideo.addEventListener("error", () => {
      mariahVideo.style.visibility = "hidden";
      mariahFallback.style.display = "block";
    });

    setTimeout(() => {
      if (!metaLoaded) {
        mariahVideo.style.visibility = "hidden";
        mariahFallback.style.display = "block";
      }
    }, 2500);

    // å¹æ°£äº’å‹•
    const mariahWrap = document.getElementById("mariahWrap");
    const fog = document.createElement("div");
    fog.style.position = "absolute";
    fog.style.inset = "0";
    fog.style.pointerEvents = "none";
    fog.style.backdropFilter = "blur(0px)";
    fog.style.transition = "backdrop-filter 0.15s ease";
    fog.style.borderRadius = "8px";
    mariahWrap.appendChild(fog);

    let blowing = false;
    let blurLevel = 0;
    let blowCount = 0;

    function startBlow() {
      blowing = true;
      blurLevel = Math.min(12, blurLevel + 2);
      fog.style.backdropFilter = `blur(${blurLevel}px)`;
    }
    function stopBlow() {
      if (!blowing) return;
      blowing = false;
      blowCount++;
      setTimeout(() => {
        blurLevel = Math.max(0, blurLevel - 1.5);
        fog.style.backdropFilter = `blur(${blurLevel}px)`;
      }, 200);

      if (blowCount >= 3) {
        const overlay = document.getElementById("xmasOverlay");
        overlay.style.display = "flex";
        overlay.innerHTML = `
          <div style="
            max-width:380px;
            padding:24px;
            border-radius:16px;
            background:rgba(115, 127, 78, 0.3);
            backdrop-filter:blur(12px);
            border:2px solid rgba(204, 160, 50, 0.8);
            box-shadow:0 0 30px rgba(188, 92, 55, 0.4), 0 0 20px rgba(204, 160, 50, 0.3);
            text-align:center;
          ">
            <div style="font-size:20px;color:#fef08a;margin-bottom:14px;font-weight:600;">
              ğŸ’¬ Mariahï¼šä½ å·²ç¶“ç­‰ä¸åŠè¦å…ˆè½æˆ‘å”±äº†å—ï¼Ÿ
            </div>
            <div style="font-size:14px;color:#fef9e6;margin-bottom:18px;opacity:0.9;">
              æ»‘é¼ å†é»ä¸€æ¬¡æ‰æ’­éŸ³æ¨‚ã€‚ï¼ˆğŸ¶ æ’­æ”¾ / âŒ å–æ¶ˆï¼‰
            </div>
            <button id="playBtn" style="
              background:linear-gradient(135deg,#BC5C37 0%, #a54d2f 100%);
              border:2px solid #CCA032;color:#fff;padding:10px 20px;border-radius:8px;
              font-size:16px;cursor:pointer;margin:4px 8px;font-weight:600;
            ">ğŸ¶ æ’­æ”¾</button>
            <button id="cancelBtn" style="
              background:rgba(115, 127, 78, 0.6);
              border:2px solid rgba(204, 160, 50, 0.8);
              color:#fff;padding:10px 20px;border-radius:8px;
              font-size:16px;cursor:pointer;margin:4px 8px;font-weight:600;
            ">âŒ å–æ¶ˆ</button>
          </div>
        `;
        document.getElementById("playBtn").onclick = () => {
          overlay.innerHTML = `
            <iframe
              src="https://www.youtube.com/embed/aAkMkVFwAoo?autoplay=1&controls=1&fs=1&rel=0&mute=0"
              allow="autoplay; fullscreen"
              allowfullscreen
              style="width:100%;height:100%;border:none;">
            </iframe>
          `;
        };
        document.getElementById("cancelBtn").onclick = () => { overlay.style.display = "none"; };
      }
    }

    mariahWrap.addEventListener("mousedown", startBlow);
    document.addEventListener("mouseup", stopBlow);
    mariahWrap.addEventListener("touchstart", (e) => { e.preventDefault(); startBlow(); }, { passive: false });
    document.addEventListener("touchend", stopBlow);
    document.addEventListener("keydown", (e) => { if (e.code === "Space") { e.preventDefault(); startBlow(); }});
    document.addEventListener("keyup", (e) => { if (e.code === "Space") { stopBlow(); }});

    // é›ªèŠ±
    const snowflakes = [];
    const maxSnow = 50;
    class Snow {
      constructor() {
        this.size = Math.random() * 10 + 6;
        this.x = Math.random() * window.innerWidth;
        this.y = -this.size;
        this.vx = (Math.random() - 0.5) * 0.3;
        this.vy = Math.random() * 0.5 + 0.2;
        this.el = document.createElement('div');
        this.el.className = 'snowflake';
        this.el.textContent = 'â„ï¸';
        this.el.style.fontSize = this.size + 'px';
        document.body.appendChild(this.el);
      }
      update() {
        this.x += this.vx; this.y += this.vy;
        if (this.y >= window.innerHeight - this.size) {
          this.y = window.innerHeight - this.size;
          this.vy = 0; this.vx = 0;
        }
        this.el.style.left = this.x + 'px';
        this.el.style.top = this.y + 'px';
      }
    }
    function createSnow() { if (snowflakes.length < maxSnow) snowflakes.push(new Snow()); }
    function animateSnow() { createSnow(); snowflakes.forEach(s => s.update()); requestAnimationFrame(animateSnow); }
    animateSnow();
  </script>
</body>
</html>
